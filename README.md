# Bot Birja Zakazov (Telegram, Python)

Телеграм-бот для безопасной работы между **Заказчиком** и **Исполнителем** с депозитом (escrow), email-подтверждением и автоматическим возвратом средств при просрочке подтверждения.

## Возможности

- Первый запуск: выбор статуса **Заказчик / Исполнитель**.
- Заказчик:
  - создаёт заказ,
  - оплачивает заказ (сумма уходит в резерв депозита),
  - выбирает исполнителя из откликнувшихся.
- Исполнитель:
  - получает список заказов,
  - откликается,
  - после выполнения нажимает **Сдать заказ**.
- Email-проверка:
  - боту отправляется код подтверждения,
  - код проверяется на корректность и уникальность,
  - при успехе депозит перечисляется исполнителю.
- Код подтверждения записывается в БД и больше не может быть использован повторно.
- Заказчик получает сообщение о завершении заказа и ссылку на объявление.
- Если срок подтверждения истёк — деньги автоматически возвращаются заказчику.

## Стек

- Python 3.11+
- aiogram 3
- sqlite3 (встроенная БД)
- imaplib/smtplib (встроенные email-клиенты)

## Быстрый старт

1. Установить зависимости:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

2. Скопировать `.env.example` в `.env` и заполнить:

```bash
cp .env.example .env
```

3. Запустить:

```bash
python bot.py
```

## Команды бота

- `/start` — запуск и меню.
- `/set_email user@example.com` — сохранить email исполнителя для отправки кода.

## База данных

Файл SQLite: `bot.db` (по умолчанию, можно изменить через `DATABASE_PATH` в `.env`).

Таблицы:
- `users`
- `orders`
- `order_responses`
- `used_confirmation_codes`

## Примечания по email

Для работы email-части требуется:
- рабочая пара SMTP/IMAP от почтового ящика бота,
- корректный логин/пароль приложения (или обычный пароль, если провайдер разрешает).

Бот ищет входящие письма с шаблоном:
- `ORDER-<id>`
- `CODE-<6-цифр>`
